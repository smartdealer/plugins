<?php
   /**
    * The template body
    *
    * @package   Smart Dealer Wordpress Plugin
    * @author    Patrick Otto <patrick@smartdealership.com.br>
    * @version   2.0.2
    * @access    public
    * @copyright Smart Dealer(c), 2017-2018
    * @see       http://smartdealer.com.br
    */
   $totais = $this->getTotals();
   
   $valid = (!empty($totais) && is_array($totais) && key_exists(0, $totais)) && key_exists('preco_min', $totais[0]);
   $pr_min = (int) ($valid) ? min(\SmartDealer::array_column((array) $totais, 'preco_min')) : 0;
   $pr_max = (int) ($valid) ? max(\SmartDealer::array_column((array) $totais, 'preco_max')) : 0;
   $ye_min = (int) ($valid) ? min(\SmartDealer::array_column((array) $totais, 'ano_min')) : date('Y');
   $ye_max = (int) ($valid) ? max(\SmartDealer::array_column((array) $totais, 'ano_max')) : date('Y');
   ?><script>stm_lang_code="string"==typeof stm_lang_code?stm_lang_code:"pt_br",ajaxurl="string"==typeof ajaxurl?ajaxurl:"<?php echo SmartDealer::formAction() ?>",STMListings="object"==typeof STMListings?STMListings:{Filter:{prototype:{ajaxBefore:function(){},ajaxSuccess:function(){}}}},jQuery(function(){jQuery("#page-form").delegate("select","change",function(){$("#page-form").submit()})})</script><style>.stm_breadcrumbs_unit.heading-font{display:none}.pager-first a,.pager-last a{min-width:35px!important;width:100%!important}.ui-slider .ui-slider-handle:after{background-color:#fff!important}.ui-slider .ui-slider-handle{border-radius:100%!important;background:#f0f2f5}.ui-slider .ui-slider-handle:hover{cursor:pointer}.range-label{text-transform:uppercase;color:#888;font-size:10px;margin-bottom:10px}.range{margin-top:15px;font-weight:500;font-size:14px;color:#232628}.range.left{float:left}.range.right{float:right}.sidebar-action-units{margin-top:10px}.ui-slider-horizontal{height:5px!important}</style><form action="<?php echo SmartDealer::formAction() ?>"id=page-form name=busca><div class=container><div class="vc_custom_1448609395747 vc_row vc_row-fluid wpb_row"><div class="vc_col-sm-12 vc_column_container wpb_column"><div class=vc_column-inner><div class=wpb_wrapper><div class=archive-listing-page><div class=container><div class=row><div class="col-sm-12 classic-filter-row col-md-3 sidebar-sm-mg-bt"><div class="ajax-filter filter filter-sidebar"><div class=sidebar-entry-header><i class=stm-icon-car_search></i> <span class=h4>Opções de busca</span></div><div class="row row-pad-top-24"><div class="col-md-12 col-sm-6 stm-filter_condition"style=padding-bottom:15px><div class=input-group><input name=busca value="<?php echo SmartDealer::formGet('busca'); ?>"class=form-control placeholder=Busque.. aria-label=Busque..> <span class=input-group-btn><button class="btn btn-outline-secondary" style="height: 33px;
    top: -1px;" type=submit><i class="fa fa-search"></i></button></span></div></div><div class="col-md-12 col-sm-6 stm-filter_condition"><div class=form-group><select class="form-control select2-hidden-accessible"name=modelo aria-hidden=true tabindex=-1><option value=""selected>Modelo</option><?php $a = $this->getModels(); ?><?php foreach ($a as $row): ?><option value="<?php echo $row['item'] ?>"<?php if (SmartDealer::formGet('modelo') == $row['item']) echo "selected=selected" ?>><?php echo SmartDealer::prepareString($row['item'], false) ?></option><?php endforeach; ?></select></div></div><div class="col-md-12 col-sm-6 stm-filter_body"><div class=form-group><select class="form-control select2-hidden-accessible"name=cor aria-hidden=true tabindex=-1><option value=""selected>Cor</option><?php $a = $this->getColors(); ?><?php foreach ($a as $row): ?><option value="<?php echo $row['item'] ?>"<?php if (SmartDealer::formGet('cor') == $row['item']) echo "selected=selected" ?>><?php echo $row['item'] ?></option><?php endforeach; ?></select></div></div><div class="col-md-12 col-sm-6 stm-filter_make"><div class=form-group><select class="form-control select2-hidden-accessible"name=combustivel aria-hidden=true tabindex=-1><option value=""selected>Combustível</option><?php $a = $this->getFuels(); ?><?php foreach ($a as $row): ?><option value="<?php echo $row['item'] ?>"<?php if (SmartDealer::formGet('combustivel') == $row['item']) echo "selected=selected" ?>><?php echo $row['item'] ?></option><?php endforeach; ?></select></div></div><div class="col-md-12 col-sm-6 stm-filter_ca-year"><div class=form-group><label class=range-label>Faixa de ano</label><div class=range-slider-gp><div id=range-ano></div><div class=clearfix></div><div class="range left"id=range-min-ano></div><div class="range right"id=range-max-ano></div><input name=ano_min type=hidden value="<?php echo SmartDealer::formGet('ano_min', 0) ?>"id=ano-min> <input name=ano_max type=hidden value="<?php echo SmartDealer::formGet('ano_max', 0) ?>"id=ano-max></div></div></div><div class="col-md-12 col-sm-6 stm-filter_ca-year"><div class=form-group><label class=range-label>Faixa de preço</label><div class=range-slider-gp><div id=range-preco></div><div class=clearfix></div><div class="range left"id=range-min></div><div class="range right"id=range-max></div><input name=preco_min type=hidden value="<?php echo SmartDealer::formGet('preco_min', 0) ?>"id=preco-min> <input name=preco_max type=hidden value="<?php echo SmartDealer::formGet('preco_max', 0) ?>"id=preco-max></div></div></div></div><input name=view_type type=hidden id=stm_view_type> <input name=stm_filter_link type=hidden id=stm-filter-links-input> <input name=popular type=hidden> <input name=s type=hidden> <input name=sort_order type=hidden> <input name=st_preco_min type=hidden value="<?php echo $pr_min ?>"> <input name=st_preco_max type=hidden value="<?php echo $pr_max ?>"> <input name=st_ano_min type=hidden value="<?php echo $ye_min ?>"> <input name=st_ano_max type=hidden value="<?php echo $ye_max ?>"><div class=sidebar-action-units><input type=submit value="Mostrar carros"id=stm-classic-filter-submit class=hidden> <a href="<?php echo SmartDealer::formAction() ?>"class=button><span>Resetar tudo</span></a></div></div></div><div class="col-sm-12 col-md-9"><div class=stm-ajax-row><div class="clearfix stm-car-listing-sort-units"><div class="clearfix stm-sort-by-options"><span>Ordenar por:</span><div class=stm-select-sorting><div class="col-md-12 input-order"><select class="form-control input-sm pull-right select-order"name=campo_ordenador><option value=modelo<?php if (SmartDealer::formGet('campo_ordenador') == 'modelo') echo "selected=selected" ?>>Modelo<option value=cor<?php if (SmartDealer::formGet('campo_ordenador') == 'cor') echo "selected=selected" ?>>Cor<option value=preco<?php if (SmartDealer::formGet('campo_ordenador') == 'preco') echo "selected=selected" ?>>Preço<option value=ano<?php if (SmartDealer::formGet('campo_ordenador') == 'ano') echo "selected=selected" ?>>Ano</select> <input name=sentido_ordenacao type=hidden value=ASC></div></div></div><div class=stm-view-by><a href=# class="view-type view-grid"data-view=grid><i class=stm-icon-grid></i> </a><a href=# class="view-type active view-list"data-view=list><i class=stm-icon-list></i></a></div></div><div id=listings-result><div class="stm-isotope-sorting stm-isotope-sorting-list"><?php
                                          $data = $this->getData();
                                          ?><?php if ($data && is_array($data)): ?><?php foreach ($data as $row) : ?><?php $img = explode('/', substr($row['url_imagem'], 0, -4)); ?><div class="listing-list-loop stm-isotope-listing-item stm-listing-directory-list-loop"><div class=image><a href="<?php echo SmartDealer::link($row['veiculo_chassi'], $row['modelo']); ?>"class=rmv_txt_drctn><div class=image-inner><img alt="<?php echo $row['modelo']; ?>"alt=""class="img-responsive lazy wp-post-image"data-src="<?php echo SmartDealer::img($row['id'], $img[0], $img[1], 257) ?>"height=auto src="<?php echo SmartDealer::urlPlugin('template/default/assets/img/pre-img.jpg'); ?>" width=300></div></a></div><div class=content><div class=meta-top><div class="discounted-price price"><?php if (intval($row['preco_promocional'])): ?><div class=regular-price><?php echo SmartDealer::preparePrice($row['preco'], 1, 0) ?></div><div class=sale-price><?php echo SmartDealer::preparePrice($row['preco_promocional'], 1, 0) ?></div><?php else: ?><div class=normal-price><span class=heading-font><?php echo SmartDealer::preparePrice($row['preco'], 1, 0) ?></span></div><?php endif; ?></div><div class="heading-font title"><a href="<?php echo SmartDealer::link($row['veiculo_chassi'], $row['modelo']); ?>"class=rmv_txt_drctn><?php echo SmartDealer::prepareString($row['modelo'], true) ?></a></div></div><div class=meta-middle><div class=meta-middle><div class="font-exists meta-middle-unit make"><div class=meta-middle-unit-top><div class=icon><i class="fa fa-certificate"></i></div><div class=name>Marca</div></div><div class="h5 value"><?php echo SmartDealer::prepareName($row['marca']) ?></div></div><div class="font-exists meta-middle-unit mileage"><div class=meta-middle-unit-top><div class=icon><i class=stm-icon-road></i></div><div class=name>Km</div></div><div class="h5 value"><?php echo ($row['km']) ?></div></div><div class="font-exists meta-middle-unit fuel"><div class=meta-middle-unit-top><div class=icon><i class=stm-icon-fuel></i></div><div class=name>Combustível</div></div><div class="h5 value"><?php echo SmartDealer::prepareName($row['combustivel'], false) ?></div></div><div class="font-exists meta-middle-unit engine"><div class=meta-middle-unit-top><div class=icon><i class=stm-icon-engine_fill></i></div><div class=name>Motor</div></div><div class="h5 value"><?php echo SmartDealer::prepareString($row['motor'], false) ?></div></div><div class="font-exists meta-middle-unit ca-year"><div class=meta-middle-unit-top><div class=icon><i class="fa fa-exchange"></i></div><div class=name>Ano</div></div><div class="h5 value"><?php $year = explode('/', $row['ano_fab_mod']); ?><?php echo SmartDealer::prepareYear(next($year)); ?></div></div><div class="font-exists meta-middle-unit transmission"><div class=meta-middle-unit-top><div class=icon><i class=stm-icon-transmission_fill></i></div><div class=name>Transmissão</div></div><div class="h5 value"><?php echo SmartDealer::prepareString($row['transmissao'], false) ?></div></div><div class="font-exists meta-middle-unit drive"><div class=meta-middle-unit-top><div class=icon><i class=stm-icon-drive_2></i></div><div class=name>Portas</div></div><div class="h5 value"><?php echo ($row['portas']) ?></div></div><div class="font-exists meta-middle-unit exterior-color"><div class=meta-middle-unit-top><div class=icon><i class=stm-boats-icon-narrow-boat-painting></i></div><div class=name>Cor externa</div></div><div class="h5 value"><?php echo SmartDealer::prepareName($row['cor']) ?></div></div></div></div><div class=meta-bottom><div class=single-car-actions><ul class="clearfix list-unstyled"><li><div class="heading-font stock-num"><span>CÓD #</span><?php echo ($row['id']) ?></div><li><a href=# class="car-action-unit stm-schedule"data-target=#test-drive data-toggle=modal onclick='stm_test_drive_car_title("<?php echo $row['veiculo_chassi'] ?>","<?php echo $row['modelo']; ?>")'><i class=stm-icon-steering_wheel></i> Agendar Best Drive</a></ul></div></div></div></div><?php endforeach; ?><?php else: ?><div class=col-sm-12><center><h3>Não foram encontrados resultados</h3></center></div><?php endif; ?></div><div class="stm-blog-pagination stm_ajax_pagination"><?php $pager = $this->getPager($data); ?><ul class=page-numbers><?php foreach ($pager as $link): ?><li class="<?php echo $link['class']; ?>"><?php if ($link['atual']) : ?><span class="page-numbers current"aria-current=page><?php echo $link['text']; ?></span><?php else: ?><a href="<?php echo ($link['atual']) ? 'javascript:return false' : $link['link']; ?>"><?php echo $link['text']; ?></a><?php endif; ?></li><?php endforeach; ?></ul></div></div></div></div></div></div></div></div></div></div></div><div class=clearfix style=margin-bottom:40px></div></div></form><script src="<?php echo SmartDealer::url('js/estoque.js'); ?>"></script>